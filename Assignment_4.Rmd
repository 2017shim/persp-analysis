---
title: "Assignment 4"
author: "Gabriel Velez"
date: "10/31/2017"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
set.seed(1234)
```


##1.
(3 points) Let the standard deviation of your income process be σ = 0.1, let the persistence be ρ = 0.2, let the long-run growth rate of income be g = 0.03, and let the average initial income be inc0 = $80, 000.

Assume you will work for 40 years after you graduate (2019 to 2058). Simulate 10,000 different realizations of your lifetime income. Do this by first drawing 10,000 sets of 40 normally distributed errors with mean 0 and standard deviation σ = 0.1. Then plug those into the income process defined above to simulate your lifetime income. Plot one of the lifetime income paths. Make sure your axes are correctly labeled and your plot has a title.

```{r part_1, echo=FALSE}

income_year <- function(incomeYear0, p, g, year0 = 2019, years){

  errorSet <- rnorm(years, mean = 0, sd = 0.1)

  annual_income_log <- vector("numeric", years)
  
  
  for(year in seq_len(years)){
    if (year ==1){
      annual_income_log[[year]]<- log(incomeYear0) + errorSet[[year]]
    }else {
      annual_income_log[[year]] <- (1-p) * (log(incomeYear0) + g * (year-1)) + p * annual_income_log[[year-1]]+ errorSet[[year]]
    }
    
  }

data_frame(income = exp(annual_income_log),
           year = 2019 + seq_len(years) - 1)

}

n_sims <- 10000
years <- 40

#Generating 40 errors 10,000 times
simulatedIncome <- n_sims %>%
  rerun(
    income_year(incomeYear0 = 80000, p = .2, g = .03, years = years)) %>%
    bind_rows(.id = "id") %>%
    select(id, year, income)


simulatedIncome %>%
  filter(id ==1) %>%
  ggplot(aes(year, income)) +
  geom_line() +
    labs(title = "Simulated income growth over time (one simulation)",
       x = "Year", 
       y = "Annual Income") +
  scale_y_continuous(labels = scales::dollar)

```




##Part 2

2. (2 points) Plot a histogram with 50 bins of year t = 2019 initial income for each of the 10,000 simulations. What percent of your class will earn more than $100,000 in the first year out of the program? What percent of the class will earn less than $70,000? Is the distribution normally distributed (i.e. symmetric and bell-curved)?

```{r part_2, echo=FALSE}
simulatedIncome %>%
  filter(year == 2019) %>%
  ggplot(aes(income)) +
  geom_histogram(bins = 50) +
  scale_x_continuous(labels = scales::dollar) +
  labs(title = "Distribution of simulated income in 2019",
       x = "Income",
       y = "Frequency of observations")


#Greater than 100,000

simulatedIncome %>%
  filter(year == 2019) %>%
  mutate(above_100k = income > 100000) %>%
  summarize(n_above = sum(above_100k),
            n = n(),
            n_above_pct = n_above / n)

# Less than 70,000
simulatedIncome %>%
  filter(year == 2019) %>%
  mutate(below_70k = income < 70000) %>%
  summarize(n_below = sum(below_70k),
            n = n(),
            n_below_pct = n_below / n)
  
```



3. (3 points) Suppose you graduate from the MACSS program with $95,000 of zero-interest debt. You will use 10% of your annual salary after you graduate to pay off this loan. Plot the histogram of how many years it takes to pay off the loan in each of your 10,000 simulations. This histogram will only have as many bins as you have unique years in which people pay off their debt. In what percent of the simulations are you able to pay off the loan in 10 years (on or before t = 2028)?

```{r part_2, echo=FALSE}

 simulatedIncome %>%
   mutate(debt = 95000) %>%
   for(year in seq_along(id)){
     if(year == 2019) {
     debt <- (95000 - income*.1)
     } else{
       debt <- simulatedIncome$debt[year-1] - income*.1 
     }
  
   }
  
```


4. (2 points) Now suppose that the UChicago MACSS program becomes very well known in the next
year, and the skills you are learning are demanded more by employers. This increases the average starting salary to inc0 = $85, 000, but the standard deviation in incomes increases also to σ = 0.15.  Plot the new histogram of how many years it takes to pay off your loan of $95,000 in your new 10,000 simulations with the new standard deviation and the new average initial salary. In what percent of the simulations are you able to pay off the loan in 10 years (on or before t = 2028)?





